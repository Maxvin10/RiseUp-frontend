<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RiseUp</title>
    <link rel="shortcut icon" href="rasmlar/dark.png" type="image/x-icon" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "system-ui", "sans-serif"] },
            backgroundImage: {
              grid: "radial-gradient(circle at 1px 1px, rgba(148,163,184,0.18) 1px, transparent 0)",
            },
          },
        },
      };
    </script>
  </head>
  <script>
  // 1) O‚Äòng tugma (Right click) blok
  document.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    return false;
  });

  // 2) Klaviatura shortcut‚Äôlarni blok (F12, Ctrl+Shift+I/J/C, Ctrl+U, etc.)
  document.addEventListener("keydown", (e) => {
    const key = e.key?.toLowerCase?.() || "";
    const code = e.code?.toLowerCase?.() || "";

    // F12
    if (key === "f12" || code === "f12") {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }

    // Ctrl+Shift+I / J / C  (DevTools / Console / Inspector)
    if (e.ctrlKey && e.shiftKey && ["i", "j", "c"].includes(key)) {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }

    // Ctrl+U (View Source)
    if (e.ctrlKey && key === "u") {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }

    // Ctrl+S (Save page)
    if (e.ctrlKey && key === "s") {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }

    // Ctrl+P (Print)
    if (e.ctrlKey && key === "p") {
      e.preventDefault();
      e.stopPropagation();
      return false;
    }
  }, { capture: true });

  // 3) (Ixtiyoriy) Matn belgilashni ham blok qilmoqchi bo‚Äòlsang:
  // document.addEventListener("selectstart", (e) => e.preventDefault());
  // document.addEventListener("dragstart", (e) => e.preventDefault());

  // 4) (Ixtiyoriy) DevTools ochilganda ‚Äúsezishga‚Äù urinib qaytarish (ham bypass bo‚Äòladi)
  // Eslatma: bu ba‚Äôzi brauzerlarda ishlamaydi, ba‚Äôzida performancega ta‚Äôsir qiladi.
  (function devtoolsTrap() {
    const threshold = 160;
    setInterval(() => {
      const w = window.outerWidth - window.innerWidth;
      const h = window.outerHeight - window.innerHeight;
      if (w > threshold || h > threshold) {
        // Sahifani chalg‚Äòitish usuli (yumshoq):
        document.body.innerHTML = "";
      }
    }, 800);
  })();
</script>


  <body class="min-h-screen bg-slate-950 text-slate-50 font-sans antialiased">
    <!-- ‚≠ê GLOBAL DARK NEON BACKGROUND -->
    <div class="pointer-events-none fixed inset-0 -z-30 bg-slate-950"></div>

    <div class="pointer-events-none fixed inset-0 -z-20 overflow-hidden">
      <div
        class="absolute -top-40 -left-10 h-80 w-80 rounded-full bg-indigo-500/35 blur-3xl"
      ></div>
      <div
        class="absolute -bottom-40 -right-10 h-96 w-96 rounded-full bg-fuchsia-500/35 blur-3xl"
      ></div>
      <div
        class="absolute inset-0 opacity-[0.07] bg-grid bg-[length:26px_26px]"
      ></div>
    </div>

    <div
      class="pointer-events-none fixed inset-x-0 top-20 -z-10 flex justify-center"
    >
      <div
        class="h-64 w-[650px] rounded-[999px] bg-gradient-to-r from-indigo-500/40 via-sky-400/40 to-fuchsia-400/40 blur-3xl opacity-70"
      ></div>
    </div>
    <!-- ‚≠ê END BACKGROUND -->

    <div class="flex h-screen relative">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="fixed md:static inset-y-0 left-0 z-[100] w-64 bg-slate-900/85 shadow-2xl shadow-slate-950/70 border-r border-slate-800 flex flex-col transition-all duration-300 ease-in-out flex-shrink-0 -translate-x-full md:translate-x-0 hidden"
        data-hidden-on-home="true"
      >
        <!-- Sidebar Header -->
        <div class="p-6 border-b border-slate-800/80">
          <div class="flex items-center justify-between gap-3">
            <div class="flex items-center gap-3 overflow-hidden">
              <div
                class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-sky-500 rounded-lg flex items-center justify-center flex-shrink-0 shadow-lg shadow-indigo-500/40"
              >
                <img class="rounded-lg" src="rasmlar/darkrise.png" alt="" />
              </div>
              <div
                id="logoText"
                class="whitespace-nowrap transition-opacity duration-300 opacity-100"
              >
                <h1 id="welcomeText" class="text-lg font-bold text-slate-50">
                  RiseUp
                </h1>
                <p id="logoSub" class="text-sm text-slate-400">
                  Learning Platform
                </p>
              </div>
            </div>

            <button
              id="toggleBtn"
              onclick="toggleSidebar()"
              class="p-2 hover:bg-slate-800/80 rounded-lg transition-colors flex-shrink-0"
              title="Sidebar"
            >
              <svg
                class="w-5 h-5 text-slate-300"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
          <!-- Home / Admin placeholder -->
          <div id="homeContainer"></div>

          <!-- Progress / Dashboard -->
          <a
            href="bolimlar/progress.html"
            target="contentFrame"
            class="flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-slate-800/80 hover:text-indigo-300 transition-all"
          >
            <span class="text-xl">üíª</span>
            <span class="nav-label">Kurslar</span>
          </a>

          <!-- Tasks -->
          <a
            onclick="navigateToPage('bolimlar/task.html')"
            class="cursor-pointer flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-slate-800/80 hover:text-indigo-300 transition-all"
          >
            <span class="text-xl">üìñ</span>
            <span class="nav-label">Vazifalar</span>
          </a>

          <!-- Statistics -->
          <a
            onclick="navigateToPage('bolimlar/statistic.html')"
            class="cursor-pointer flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-slate-800/80 hover:text-indigo-300 transition-all"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-indigo-400"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M3 3v18h18" />
              <path d="M8 13h3v5H8zM13 9h3v9h-3zM18 5h3v13h-3z" />
            </svg>
            <span class="nav-label">Statistika</span>
          </a>
          
          <!-- Settings -->
          <a
            href="bolimlar/settings.html"
            target="contentFrame"
            class="flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-slate-800/80 hover:text-indigo-300 transition-all"
          >
            <span class="text-xl">‚öôÔ∏è</span>
            <span class="nav-label">Sozlamalar</span>
          </a>
          
          <!-- Telegram Bot -->
          <a
            href="https://t.me/riseupuz_bot"
            target="_blank"
            rel="noopener"
            class="flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-slate-800/80 hover:text-indigo-300 transition-all"
          >
            <span class="text-xl">ü§ñ</span>
            <span class="nav-label">TG botga o‚Äòtish</span>
          </a>
        </nav>

        <!-- Footer -->
        <div class="p-4 border-t border-slate-800/80">
          <a
            onclick="logoutUser()"
            class="cursor-pointer flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-rose-900/40 hover:text-rose-300 transition-all"
          >
            <span class="text-xl">üö™</span>
            <span class="nav-label">Chiqish</span>
          </a>
        </div>
      </aside>

      <!-- Mobile overlay (sidebar ochilganda tashqi joy bosilsa yopiladi) -->
      <div
        id="sidebarOverlay"
        class="fixed inset-0 z-[90] hidden bg-black/50 backdrop-blur-[2px] md:hidden"
      ></div>

      <!-- Main Content -->
      <main class="flex-1 overflow-auto">
        <iframe
          name="contentFrame"
          src="bolimlar/progress.html"
          class="w-full h-screen border-none"
        ></iframe>
      </main>
    </div>

    <script>
      // =========================
      // Sidebar collapse/expand helpers
      // =========================
      function collapseSidebar() {
        const sidebar = document.getElementById("sidebar");

        // overlay bosilganda sidebar yopilsin (mobile)
        const overlay = document.getElementById("sidebarOverlay");
        if (overlay) overlay.addEventListener("click", closeMobileSidebar);

        const logoText = document.getElementById("logoText");
        const navLabels = document.querySelectorAll(".nav-label");
        if (!sidebar) return;

        sidebar.classList.add("collapsed", "w-20");
        sidebar.classList.remove("w-64");
        if (logoText) logoText.classList.add("hidden");
        navLabels.forEach((l) => l.classList.add("hidden"));
      }

      function expandSidebar() {
        const sidebar = document.getElementById("sidebar");
        const logoText = document.getElementById("logoText");
        const navLabels = document.querySelectorAll(".nav-label");
        if (!sidebar) return;

        sidebar.classList.remove("collapsed", "w-20");
        sidebar.classList.add("w-64");
        if (logoText) logoText.classList.remove("hidden");
        navLabels.forEach((l) => l.classList.remove("hidden"));
      }

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        if (!sidebar) return;

        const isCollapsed = sidebar.classList.contains("collapsed");
        if (isCollapsed) expandSidebar();
        else collapseSidebar();

        // user tanlovini saqlab qo'yamiz
        try {
          localStorage.setItem("sidebarCollapsed", isCollapsed ? "0" : "1");
        } catch (e) {}
      }

      // ‚úÖ 700px dan past bo'lsa auto-collapse
      function setupResponsiveSidebar() {
        const mq = window.matchMedia("(max-width: 700px)");

        function applyByScreen() {
          // ‚úÖ 765px va pastda drawer ishlaydi, collapse logika aralashmasin
          if (window.innerWidth <= 765) return;
          const sidebar = document.getElementById("sidebar");
          if (!sidebar) return;

          // sidebar hidden bo'lsa (masalan, home rejim), majburlamaymiz
          if (sidebar.classList.contains("hidden")) return;

          if (mq.matches) {
            collapseSidebar();
          } else {
            // katta ekranda: agar user collapse qilib qo'ygan bo'lsa, shuni qoldiramiz
            const saved = localStorage.getItem("sidebarCollapsed");
            if (saved === "1") collapseSidebar();
            else expandSidebar();
          }
        }

        // initial
        applyByScreen();

        // breakpoint change
        if (mq.addEventListener) mq.addEventListener("change", applyByScreen);
        else mq.addListener(applyByScreen);

        // fallback resize
        window.addEventListener("resize", applyByScreen);
      }

      // =========================
      // Page load: iframe route restore + sidebar show
      // =========================
      
      // =========================
      // MOBILE SIDEBAR DRAWER (<=765px)
      // =========================
      function isMobileScreen() {
        return window.innerWidth <= 765;
      }

      function openMobileSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");
        if (!sidebar || !overlay) return;

        // agar sidebar home uchun hidden bo'lsa, ochmaymiz
        if (sidebar.classList.contains("hidden")) return;

        if (!isMobileScreen()) return;

        sidebar.classList.remove("-translate-x-full");
        sidebar.classList.add("translate-x-0");

        overlay.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      function closeMobileSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");
        if (!sidebar || !overlay) return;

        if (!isMobileScreen()) {
          overlay.classList.add("hidden");
          document.body.style.overflow = "";
          return;
        }

        sidebar.classList.add("-translate-x-full");
        sidebar.classList.remove("translate-x-0");

        overlay.classList.add("hidden");
        document.body.style.overflow = "";
      }

      function toggleMobileSidebar() {
        const sidebar = document.getElementById("sidebar");
        if (!sidebar) return;
        const isOpen = !sidebar.classList.contains("-translate-x-full");
        if (isOpen) closeMobileSidebar();
        else openMobileSidebar();
      }

      // iframe ichidan chaqirish uchun
      window.openMobileSidebar = openMobileSidebar;
      window.closeMobileSidebar = closeMobileSidebar;
      window.toggleMobileSidebar = toggleMobileSidebar;

      // resize: desktopga o'tsa sidebar joyida tursin, mobileda default yopiq
      window.addEventListener("resize", () => {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");
        if (!sidebar || !overlay) return;

        if (isMobileScreen()) {
          // mobilega o'tganda yopib qo'yamiz
          closeMobileSidebar();
        } else {
          // desktopda overlay yo'q, sidebar joyida
          overlay.classList.add("hidden");
          document.body.style.overflow = "";
          sidebar.classList.remove("-translate-x-full");
          sidebar.classList.add("translate-x-0");
        }
      });


      window.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get("page");
        const contentFrame = document.querySelector(
          'iframe[name="contentFrame"]'
        );
        const sidebar = document.getElementById("sidebar");

        function resolvePageFromParam(p) {
          if (!p) return null;
          if (p === "task") return "bolimlar/task.html";
          if (p === "statistic") return "bolimlar/statistic.html";
          return p;
        }

        const lastSaved = localStorage.getItem("lastContentPage");
        const resolvedFromParam = resolvePageFromParam(page);
        const srcToLoad =
          resolvedFromParam || lastSaved || "bolimlar/progress.html";

        contentFrame.src = srcToLoad;

        // known pages -> show sidebar
        if (
          srcToLoad &&
          (srcToLoad.includes("task.html") ||
            srcToLoad.includes("statistic.html") ||
            srcToLoad.includes("progress.html"))
        ) {
          sidebar.classList.remove("hidden");
          // mobileda default yopiq turadi
          try { if (window.innerWidth <= 765) closeMobileSidebar(); } catch (e) {}

        }

        // ensure sidebar position on load
        try {
          if (window.innerWidth > 765) {
            sidebar.classList.remove("-translate-x-full");
            sidebar.classList.add("translate-x-0");
          } else {
            closeMobileSidebar();
          }
        } catch (e) {}

        // welcome text
        setWelcomeName();

        // ‚úÖ responsive sidebar (700px)
        setupResponsiveSidebar();
      });

      function navigateToPage(page) {
        const sidebar = document.getElementById("sidebar");
        const contentFrame = document.querySelector(
          'iframe[name="contentFrame"]'
        );

        sidebar.classList.remove("hidden");
        contentFrame.src = page;

        // persist
        try {
          localStorage.setItem("lastContentPage", page);
        } catch (err) {}
        // apply responsive collapse/expand right away
        try {
          setupResponsiveSidebar();
        } catch (e) {}
      }

      function navigateToHome() {
        window.location.href = "index.html";
      }

      // =========================
      // Welcome name
      // =========================
      function setWelcomeName() {
        const welcomeEl = document.getElementById("welcomeText");
        if (!welcomeEl) return;

        const keys = [
          "fullName",
          "username",
          "user",
          "name",
          "displayName",
          "display_name",
          "email",
          "adminEmail",
        ];
        let found = null;
        for (const k of keys) {
          const v = localStorage.getItem(k);
          if (v) {
            found = v;
            break;
          }
        }

        if (found) {
          let name = found;
          if (found.includes("@")) name = found.split("@")[0];
          const pretty = name.charAt(0).toUpperCase() + name.slice(1);
          welcomeEl.textContent = "Xush kelibsiz, " + pretty;
          const sub = document.getElementById("logoSub");
          if (sub) sub.textContent = pretty;
        } else {
          welcomeEl.textContent = "RiseUp";
          const sub = document.getElementById("logoSub");
          if (sub) sub.textContent = "Learning Platform";
        }
      }

      window.addEventListener("storage", (e) => {
        if (
          !e.key ||
          [
            "fullName",
            "username",
            "user",
            "name",
            "displayName",
            "display_name",
            "email",
            "adminEmail",
          ].includes(e.key)
        ) {
          setWelcomeName();
        }
        if (e.key === "admin_session") {
          // admin link rerender
          try {
            renderHomeAdminLink();
          } catch (e) {}
        }
      });

      // =========================
      // iframe load: keep sidebar visible + persist last page
      // =========================
      document
        .querySelector('iframe[name="contentFrame"]')
        .addEventListener("load", function () {
          const sidebar = document.getElementById("sidebar");
          const currentSrc = this.src;

          if (
            currentSrc.includes("progress.html") ||
            currentSrc.includes("task.html") ||
            currentSrc.includes("statistic.html")
          ) {
            sidebar.classList.remove("hidden");
            try { if (window.innerWidth <= 765) closeMobileSidebar(); } catch (e) {}
          }

          try {
            if (currentSrc.includes("task.html"))
              localStorage.setItem("lastContentPage", "bolimlar/task.html");
            else if (currentSrc.includes("statistic.html"))
              localStorage.setItem(
                "lastContentPage",
                "bolimlar/statistic.html"
              );
            else if (currentSrc.includes("progress.html"))
              localStorage.setItem("lastContentPage", "bolimlar/progress.html");
            else localStorage.setItem("lastContentPage", currentSrc);
          } catch (err) {}
        });

      // =========================
      // Logout (‚úÖ confirm to'g'rilandi)
      // =========================
      function logoutUser() {
        const ok = confirm("Chiqishni xohlaysizmi?");
        if (ok) window.location.href = "login.html";


        localStorage.removeItem("access");
        localStorage.removeItem("refresh");
        localStorage.removeItem("username");
        localStorage.removeItem("email");
        localStorage.removeItem("user");
        localStorage.removeItem("name");
        localStorage.removeItem("fullName");
        localStorage.removeItem("admin_session");

        window.location.href = "login.html";
      }

      // =========================
      // Home/Admin link manager
      // =========================
      function renderHomeAdminLink() {
        const container = document.getElementById("homeContainer");
        if (!container) return;

        container.innerHTML = "";
        const isAdmin = localStorage.getItem("admin_session") === "1";

        if (isAdmin) {
          const a = document.createElement("a");
          a.href = "admin/admin.html";
          a.target = "contentFrame";
          a.className =
            "flex items-center gap-3 px-4 py-3 text-slate-300 rounded-lg hover:bg-slate-800/80 hover:text-indigo-300 transition-all";
          a.innerHTML =
            '<span class="text-xl">üè†</span><span class="nav-label">Admin</span>';
          container.appendChild(a);
        } else {
          container.innerHTML = "";
        }
      }

      (function manageHomeAdminLink() {
        try {
          renderHomeAdminLink();
        } catch (err) {
          console.warn("manageHomeAdminLink error", err);
        }
      })();
    </script>
  </body>
</html>
