<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Tasks</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','system-ui','sans-serif'] },
          backgroundImage: {
            'grid': 'radial-gradient(circle at 1px 1px, rgba(148,163,184,0.18) 1px, transparent 0)',
          }
        }
      }
    }
  </script>

  <style>
    
      html, body { overflow-x: hidden; }
      img, video, iframe { max-width: 100%; }
/* Scroll chiroyli */
    * { scrollbar-width: thin; scrollbar-color: rgba(148,163,184,.35) rgba(15,23,42,.25); }
    *::-webkit-scrollbar { height: 10px; width: 10px; }
    *::-webkit-scrollbar-thumb { background: rgba(148,163,184,.35); border-radius: 999px; }
    *::-webkit-scrollbar-track { background: rgba(15,23,42,.25); border-radius: 999px; }

    .material-icons { font-family: 'Material Icons'; }

    /* date/time input icon */
    input[type="date"], input[type="time"] { color-scheme: dark; }
  </style>
  <link rel="stylesheet" href="base.css" />
</head>

<body class="min-h-screen bg-slate-950 text-slate-50 font-sans antialiased selection:bg-sky-500/30 selection:text-white pb-16">

  <!-- BACKGROUND (progress.html style) -->
  <div class="pointer-events-none fixed inset-0 -z-30 bg-slate-950"></div>

  <div class="pointer-events-none fixed inset-0 -z-20 overflow-hidden">
    <div class="absolute -top-40 -left-10 h-80 w-80 rounded-full bg-indigo-500/35 blur-3xl"></div>
    <div class="absolute -bottom-40 -right-10 h-96 w-96 rounded-full bg-fuchsia-500/35 blur-3xl"></div>
    <div class="absolute inset-0 opacity-[0.07] bg-grid bg-[length:26px_26px]"></div>
  </div>

  <div class="pointer-events-none fixed inset-x-0 top-24 -z-10 flex justify-center">
    <div class="h-64 w-[720px] rounded-[999px] bg-gradient-to-r from-indigo-500/40 via-sky-400/40 to-fuchsia-400/40 blur-3xl opacity-70"></div>
  </div>
  <!-- END BACKGROUND -->

  <div class="max-w-6xl mx-auto mt-7 p-4 sm:p-5 md:p-6 bg-slate-900/70 border border-slate-700/70 rounded-2xl shadow-[0_28px_80px_rgba(15,23,42,0.9)] backdrop-blur-xl">
    <!-- HEADER -->
    <header class="flex items-center gap-4 mb-5">
      <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-indigo-500 to-slate-800 flex items-center justify-center text-indigo-100 font-extrabold text-lg shadow-[0_10px_30px_rgba(79,70,229,0.6)]">
        ❓
      </div>
      <div class="min-w-0">
        <h1 class="m-0 text-xl md:text-2xl font-extrabold tracking-tight text-slate-100">
          Savol tuzish va saqlash
        </h1>
        <p class="text-sm md:text-base text-slate-300 mt-1">
          Savollarni yarating, tahrirlang va serverda saqlang.
        </p>
      </div>
    </header>

    <!-- MAIN GRID -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">

      <!-- LEFT: FORM -->
      <div class="lg:col-span-2 bg-slate-950/40 border border-slate-700/70 rounded-2xl p-4 sm:p-5 shadow-[0_18px_60px_rgba(15,23,42,0.9)]">
        <form id="questionForm" onsubmit="return false;" class="space-y-4">

          <!-- Savol matni -->
          <div>
            <label class="block mb-2 text-sm font-semibold text-slate-200">Savol matni</label>
            <textarea
              id="title"
              placeholder="Savolni kiriting..."
              class="w-full min-h-[110px] resize-y rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 placeholder:text-slate-500 outline-none focus:border-sky-400/70 transition"
            ></textarea>
          </div>

          <!-- type + category -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-2">
              <label class="block mb-2 text-sm font-semibold text-slate-200">Savol turi</label>
              <select
                id="type"
                class="w-full rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 outline-none focus:border-sky-400/70 transition"
              >
                <option value="short">Qisqa javob</option>
                <option value="mcq">Ko'p tanlovli</option>
                <option value="checkbox">Checkbox</option>
              </select>
            </div>

            <div>
              <label class="block mb-2 text-sm font-semibold text-slate-200">Kategoriya</label>
              <input
                id="category"
                type="text"
                placeholder="Masalan: Matematika"
                class="w-full rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 placeholder:text-slate-500 outline-none focus:border-sky-400/70 transition"
              />
            </div>
          </div>

          <!-- date + time -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block mb-2 text-sm font-semibold text-slate-200">Sana</label>
              <input
                id="date"
                type="date"
                required
                class="w-full rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 outline-none focus:border-sky-400/70 transition"
              />
            </div>
            <div>
              <label class="block mb-2 text-sm font-semibold text-slate-200">Vaqt</label>
              <input
                id="time"
                type="time"
                required
                class="w-full rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 outline-none focus:border-sky-400/70 transition"
              />
            </div>
          </div>

          <!-- OPTIONS AREA -->
          <div id="optionsArea" class="hidden bg-slate-950/60 border border-slate-700/70 rounded-2xl p-4">
            <div class="flex items-center justify-between gap-3">
              <label class="text-sm md:text-base font-extrabold text-slate-100">Javob variantlari</label>
              <span class="text-sm text-slate-400">MCQ / Checkbox</span>
            </div>

            <div id="optionsList" class="mt-3 space-y-2"></div>

            <button
              id="addOption"
              type="button"
              class="mt-3 inline-flex items-center gap-2 rounded-2xl border border-indigo-400/40 bg-indigo-500/10 px-4 py-2.5 text-sm font-extrabold text-indigo-200 hover:bg-indigo-500/15 transition"
            >
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Variant qo'shish
            </button>
          </div>

          <!-- SHORT ANSWER -->
          <div id="shortAnswerArea" class="hidden bg-slate-950/60 border border-slate-700/70 rounded-2xl p-4">
            <label class="block mb-2 text-sm md:text-base font-extrabold text-slate-100">
              To'g'ri javob (qisqa javob uchun)
            </label>
            <input
              id="shortAnswer"
              type="text"
              placeholder="Masalan: 42 yoki 'Toshkent'"
              class="w-full rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 placeholder:text-slate-500 outline-none focus:border-sky-400/70 transition"
            />
          </div>

          <!-- ACTIONS -->
          <div class="flex flex-col sm:flex-row gap-3 pt-1">
            <button
              type="button"
              id="saveBtn"
              class="inline-flex items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-indigo-500 to-emerald-500 px-5 py-3 text-sm md:text-base font-extrabold text-white shadow-[0_10px_30px_rgba(34,197,94,0.35)] hover:opacity-95 transition"
            >
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                <path d="M5 5h14v14H5zM9 9h6v6H9z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Saqlash
            </button>

            <button
              type="button"
              id="clearForm"
              class="inline-flex items-center justify-center gap-2 rounded-2xl border border-slate-600/70 bg-slate-900/50 px-5 py-3 text-sm md:text-base font-extrabold text-slate-100 hover:bg-slate-800/60 transition"
            >
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                <path d="M3 6h18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Tozalash
            </button>
          </div>
        </form>
      </div>

      <!-- RIGHT: SAVED -->
      <aside class="bg-slate-950/40 border border-slate-700/70 rounded-2xl p-4 sm:p-5 shadow-[0_18px_60px_rgba(15,23,42,0.9)]">
        <div class="flex items-center justify-between mb-3">
          <h3 class="m-0 text-base md:text-lg font-extrabold text-slate-100">Saqlangan savollar</h3>
          <span class="text-sm text-slate-400" id="savedCount">0</span>
        </div>

        <input
          id="search"
          type="text"
          placeholder="Izlash..."
          class="w-full rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-3 text-sm md:text-base text-slate-100 placeholder:text-slate-500 outline-none focus:border-sky-400/70 transition mb-4"
        />

        <!-- Loader -->
        <div id="savedLoader" class="hidden items-center justify-center h-32">
          <div class="flex flex-col items-center gap-2">
            <svg width="36" height="36" viewBox="0 0 50 50" class="animate-spin">
              <circle cx="25" cy="25" r="20" stroke="#94a3b8" stroke-width="4" fill="none" stroke-linecap="round" stroke-dasharray="31.4 31.4"></circle>
            </svg>
            <div class="text-sm text-slate-400">Yuklanmoqda...</div>
          </div>
        </div>

        <div id="savedList" class="max-h-[65vh] overflow-y-auto space-y-3"></div>
      </aside>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="fixed left-3 right-3 sm:left-auto sm:right-5 bottom-5 z-[9999] max-w-[420px] sm:max-w-none rounded-2xl px-4 py-3 shadow-[0_8px_30px_rgba(15,23,42,0.9)] opacity-0 translate-y-2 transition-all duration-200 toast-safe"></div>

  <!-- QUESTION VIEW (MODAL) -->
  <div id="modalOverlay" class="hidden fixed inset-0 bg-slate-950/70 z-[999] backdrop-blur-md"></div>

  <div id="questionView" class="hidden fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[1000]
    w-[92%] max-w-xl rounded-2xl border border-slate-600/60 bg-slate-950 p-4 sm:p-5 text-slate-100 shadow-[0_24px_70px_rgba(15,23,42,0.95)]">
  </div>

<script>
// ===================== API CONFIG =====================
const API_BASE = 'http://127.0.0.1:8000/api';
const TASKS_ENDPOINT = `${API_BASE}/tasks/`;
const CREATE_TASK_ENDPOINT = `${API_BASE}/tasks/create/`;
const AUTH_REFRESH_ENDPOINT = `${API_BASE}/auth/refresh/`;

// ===================== DOM ELEMENTS =====================
const titleEl = document.getElementById("title");
const typeEl = document.getElementById("type");
const categoryEl = document.getElementById("category");
const dateEl = document.getElementById("date");
const timeEl = document.getElementById("time");
const optionsArea = document.getElementById("optionsArea");
const optionsList = document.getElementById("optionsList");
const addOptionBtn = document.getElementById("addOption");
const shortAnswerArea = document.getElementById("shortAnswerArea");
const shortAnswerEl = document.getElementById("shortAnswer");
const saveBtn = document.getElementById("saveBtn");
const clearFormBtn = document.getElementById("clearForm");
const savedList = document.getElementById("savedList");
const searchEl = document.getElementById("search");
const toastEl = document.getElementById("toast");
const savedLoader = document.getElementById("savedLoader");
const savedCount = document.getElementById("savedCount");
const modalOverlay = document.getElementById("modalOverlay");
const questionView = document.getElementById("questionView");

// ===================== AUTH =====================
function checkAuth() {
  const token = localStorage.getItem('access');
  if (!token) {
    window.location.href = 'login.html';
    return false;
  }
  return true;
}

function getAuthHeaders() {
  const token = localStorage.getItem('access');
  return {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  };
}

async function refreshToken() {
  try {
    const refresh = localStorage.getItem('refresh');
    if (!refresh) {
      window.location.href = 'login.html';
      return false;
    }

    const response = await fetch(AUTH_REFRESH_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ refresh })
    });

    if (!response.ok) {
      window.location.href = 'login.html';
      return false;
    }

    const data = await response.json();
    localStorage.setItem('access', data.access);
    return true;
  } catch (error) {
    console.error('Token refresh failed:', error);
    window.location.href = 'login.html';
    return false;
  }
}

async function authFetch(url, options = {}) {
  if (!checkAuth()) return null;
  options.headers = { ...options.headers, ...getAuthHeaders() };

  let response = await fetch(url, options);

  if (response.status === 401) {
    const refreshed = await refreshToken();
    if (!refreshed) return null;

    options.headers = { ...options.headers, ...getAuthHeaders() };
    response = await fetch(url, options);
  }

  return response;
}

// ===================== HELPERS =====================
function showToast(text, type = 'success') {
  toastEl.textContent = text;

  if (type === 'success') {
    toastEl.style.background = 'rgba(16,185,129,0.10)';
    toastEl.style.color = '#bbf7d0';
    toastEl.style.border = '1px solid rgba(34,197,94,0.7)';
  } else {
    toastEl.style.background = 'rgba(248,113,113,0.10)';
    toastEl.style.color = '#fecaca';
    toastEl.style.border = '1px solid rgba(239,68,68,0.8)';
  }

  toastEl.style.opacity = '0';
  toastEl.style.transform = 'translateY(8px)';
  setTimeout(() => {
    toastEl.style.opacity = '1';
    toastEl.style.transform = 'translateY(0)';
  }, 10);

  clearTimeout(toastEl._hideTimer);
  toastEl._hideTimer = setTimeout(() => {
    toastEl.style.opacity = '0';
    toastEl.style.transform = 'translateY(8px)';
  }, 2600);
}

function escapeHtml(s) {
  if (!s) return '';
  return String(s)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');
}

// Options UI (tailwind classlar bilan)
function createOptionRow(text = "", correct = false) {
  const row = document.createElement("div");
  row.className = "flex items-center gap-3";

  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "Variant matni";
  input.value = text;
  input.className = "flex-1 rounded-2xl border border-slate-700/70 bg-slate-950/60 px-4 py-2.5 text-sm text-slate-100 placeholder:text-slate-500 outline-none focus:border-sky-400/70 transition";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.checked = correct;
  checkbox.className = "h-5 w-5 accent-emerald-500 cursor-pointer";

  const del = document.createElement("button");
  del.type = "button";
  del.textContent = "O'chirish";
  del.className = "rounded-2xl bg-red-500/10 border border-red-400/30 px-3 py-2 text-sm font-extrabold text-red-200 hover:bg-red-500/15 transition";
  del.onclick = (e) => {
    e.preventDefault();
    row.remove();
    if (optionsList.children.length === 0) addNewOption();
  };

  row.appendChild(input);
  row.appendChild(checkbox);
  row.appendChild(del);
  return row;
}

function addNewOption() {
  optionsList.appendChild(createOptionRow());
}

function collectOptions() {
  const rows = [...optionsList.children];
  return rows.map(r => {
    const inputs = r.querySelectorAll("input");
    return { text: inputs[0].value.trim(), correct: inputs[1].checked };
  }).filter(v => v.text.length > 0);
}

// ===================== API CALLS =====================
async function loadQuestions() {
  try {
    const response = await authFetch(TASKS_ENDPOINT);
    if (!response) return [];
    if (!response.ok) throw new Error(`HTTP error ${response.status}`);
    return await response.json();
  } catch (e) {
    console.error(e);
    showToast("Savollar yuklanmadi", "error");
    return [];
  }
}

async function createTask(taskData) {
  const response = await authFetch(CREATE_TASK_ENDPOINT, {
    method: 'POST',
    body: JSON.stringify(taskData)
  });

  if (!response) return null;

  if (!response.ok) {
    let errorMsg = 'Failed to create task';
    try {
      const errorData = await response.json();
      errorMsg = errorData.error || errorMsg;
    } catch {}
    throw new Error(errorMsg);
  }

  return await response.json();
}

async function deleteTask(id) {
  try {
    const response = await authFetch(`${TASKS_ENDPOINT}${id}/delete/`, { method: 'DELETE' });
    if (!response) return false;
    return response.ok;
  } catch (e) {
    console.error(e);
    return false;
  }
}

// ===================== MODAL (oldingi logika shu yerda bo'ladi) =====================
function openQuestionWithCheckbox(q) {
  // Bu joyni o'zingdagi eski modal kod bilan almashtirib qo'y.
  // Hozir demo:
  modalOverlay.classList.remove("hidden");
  questionView.classList.remove("hidden");

  questionView.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <div class="text-lg font-extrabold">Savol</div>
      <button id="closeModal" class="rounded-2xl border border-slate-700/70 bg-slate-900/50 px-3 py-2 text-sm font-extrabold hover:bg-slate-800/60 transition">✖</button>
    </div>
    <div class="text-sm text-slate-300 mb-3">Turi: <span class="text-slate-100 font-semibold">${escapeHtml(q.type)}</span></div>
    <div class="rounded-2xl border border-slate-700/70 bg-slate-950/60 p-4 text-base text-slate-100 leading-relaxed">${escapeHtml(q.title)}</div>
  `;

  document.getElementById("closeModal").onclick = closeModal;
  modalOverlay.onclick = closeModal;
}

function closeModal() {
  modalOverlay.classList.add("hidden");
  questionView.classList.add("hidden");
  questionView.innerHTML = "";
}

// ===================== EVENT HANDLERS =====================
typeEl.addEventListener("change", () => {
  if (typeEl.value === "short") {
    optionsArea.classList.add("hidden");
    optionsList.innerHTML = "";
    shortAnswerArea.classList.remove("hidden");
  } else {
    optionsArea.classList.remove("hidden");
    if (optionsList.children.length === 0) addNewOption();
    shortAnswerArea.classList.add("hidden");
  }
});

addOptionBtn.onclick = (e) => { e.preventDefault(); addNewOption(); };

saveBtn.onclick = async (e) => {
  e.preventDefault();
  try {
    const title = titleEl.value.trim();
    if (!title) return showToast("Savol matnini kiriting!", "error");

    const date = dateEl.value;
    const time = timeEl.value;
    if (!date) return showToast("Sanani tanlang!", "error");
    if (!time) return showToast("Vaqtni tanlang!", "error");

    const type = typeEl.value;
    const category = categoryEl.value.trim();

    const localDateTimeStr = `${date}T${time}:00`;
    const localDt = new Date(localDateTimeStr);
    if (isNaN(localDt.getTime())) return showToast("Sana yoki vaqt noto‘g‘ri!", "error");

    const scheduled_time = localDt.toISOString();

    const taskData = {
      title,
      type,
      category: category || null,
      scheduled_time,
      correct_short: type === "short" ? (shortAnswerEl.value || "").trim() : "",
      options: type === "short" ? [] : collectOptions()
    };

    const savedTask = await createTask(taskData);
    if (savedTask) {
      await renderSaved();
      clearForm();
      showToast("Savol saqlandi!", "success");
    }
  } catch (err) {
    console.error('Save error:', err);
    showToast("Savolni saqlashda xatolik: " + err.message, "error");
  }
};

function clearForm() {
  titleEl.value = "";
  categoryEl.value = "";
  dateEl.value = "";
  timeEl.value = "";
  optionsList.innerHTML = "";
  shortAnswerEl.value = "";
  typeEl.value = "short";
  typeEl.dispatchEvent(new Event('change'));
  titleEl.focus();
}
clearFormBtn.onclick = () => clearForm();

async function deleteQuestionHandler(id) {
  const confirmed = confirm("Bu savolni o'chirishni xohlaysizmi?");
  if (!confirmed) return;

  const success = await deleteTask(id);
  if (success) {
    await renderSaved();
    showToast("Savol o'chirildi", "success");
  }
}

// ===================== RENDER LIST =====================
async function renderSaved(filter = "") {
  if (savedLoader) savedLoader.classList.remove("hidden");
  if (savedList) savedList.classList.add("hidden");

  const all = await loadQuestions();

  const filtered = all.filter(q =>
    (q.title + " " + (q.category || "")).toLowerCase().includes(filter.toLowerCase())
  );

  if (savedList) savedList.innerHTML = "";
  if (savedCount) savedCount.textContent = String(filtered.length);

  if (filtered.length === 0) {
    if (savedLoader) savedLoader.classList.add("hidden");
    if (savedList) {
      savedList.classList.remove("hidden");
      savedList.innerHTML = "<div class='text-slate-400 text-sm text-center py-6'>Savollar yo'q</div>";
    }
    return;
  }

  filtered.forEach(q => {
    const box = document.createElement("div");
    box.className = "rounded-2xl border border-slate-700/70 bg-slate-950/60 p-4 hover:border-indigo-400/60 hover:bg-slate-950/70 transition cursor-pointer shadow-[0_10px_30px_rgba(15,23,42,0.65)]";

    const safeTitle = escapeHtml(q.title);
    const safeCat = escapeHtml(q.category || "—");
    const createdDate = new Date(q.created_at);
    const createdStr = createdDate.toLocaleDateString('uz-UZ');

    let displayDate = createdStr;
    let displayTime = "—";
    if (q.scheduled_time) {
      const sched = new Date(q.scheduled_time);
      displayDate = sched.toLocaleDateString('uz-UZ');
      displayTime = sched.toLocaleTimeString('uz-UZ', { hour: '2-digit', minute: '2-digit' });
    }

    const typeText =
      q.type === 'short' ? 'Qisqa javob' :
      q.type === 'mcq'   ? "Ko'p tanlov" :
      q.type === 'checkbox' ? 'Checkbox' : escapeHtml(q.type);

    box.innerHTML = `
      <div class="flex items-start justify-between gap-3">
        <div class="min-w-0">
          <div class="text-base md:text-lg font-extrabold text-slate-100 leading-snug">${safeTitle}</div>

          <div class="mt-2 flex flex-wrap gap-2">
            <span class="inline-flex items-center rounded-full border border-indigo-400/30 bg-indigo-500/10 px-3 py-1 text-xs font-extrabold text-indigo-200">${typeText}</span>
            <span class="inline-flex items-center rounded-full border border-sky-400/25 bg-sky-500/10 px-3 py-1 text-xs font-extrabold text-sky-200">${safeCat}</span>
          </div>

          <div class="mt-3 text-xs md:text-sm text-slate-400">
            Yaratilgan: <span class="text-slate-300">${createdStr}</span>
          </div>
          <div class="text-xs md:text-sm text-slate-400">
            Sana: <span class="text-slate-300">${displayDate}</span> · Vaqt: <span class="text-slate-300">${displayTime}</span>
          </div>
        </div>

        <button
          class="shrink-0 rounded-2xl bg-red-500/10 border border-red-400/30 px-3 py-2 text-sm font-extrabold text-red-200 hover:bg-red-500/15 transition"
          onclick="deleteQuestionHandler(${q.id}); event.stopPropagation();"
        >
          O'chirish
        </button>
      </div>
    `;

    box.onclick = () => openQuestionWithCheckbox(q);
    savedList.appendChild(box);
  });

  if (savedLoader) savedLoader.classList.add("hidden");
  if (savedList) savedList.classList.remove("hidden");
}

searchEl.oninput = () => renderSaved(searchEl.value);

document.addEventListener('DOMContentLoaded', async () => {
  if (!checkAuth()) return;

  await renderSaved();
  typeEl.dispatchEvent(new Event('change'));

  const username = localStorage.getItem('username');
  if (username) {
    document.title = `${username} - Savollar`;
    // header subtitle mini
    const h1 = document.querySelector('h1');
    if (h1) {
      h1.innerHTML = `Savol tuzish va saqlash <span class="text-base text-slate-300">· ${escapeHtml(username)}</span>`;
    }
  }
});

function logout() {
  localStorage.removeItem('access');
  localStorage.removeItem('refresh');
  localStorage.removeItem('username');
  window.location.href = 'login.html';
}
</script>

  <script src="base.js"></script>
</body>
</html>
